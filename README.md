# blockstack.js [![CircleCI](https://img.shields.io/circleci/project/blockstack/blockstack.js/master.svg)](https://circleci.com/gh/blockstack/blockstack.js/tree/master) [![npm](https://img.shields.io/npm/v/blockstack.svg)](https://www.npmjs.com/package/blockstack) [![npm](https://img.shields.io/npm/dm/blockstack.svg)](https://www.npmjs.com/package/blockstack) [![npm](https://img.shields.io/npm/l/blockstack.svg)](https://www.npmjs.com/package/blockstack) [![Slack](http://slack.blockstack.org/badge.svg)](http://slack.blockstack.org/)

Note: If you're looking for the Blockstack CLI repo it was merged with [Blockstack Core](https://github.com/blockstack/blockstack-core).

-   [Installation](#installation)
-   [About](#about)
-   [Auth](#auth)
-   [Profiles](#profiles)
-   [Storage](#storage)
-   [Testing](#testing)
-   [Documentation](#documentation)

## Installation

    $ npm install blockstack

## About

Blockstack JS is a library for profiles/identity and authentication.

The authentication portion of this library can be used to:

1.  create an authentication request
2.  create an authentication response

The profiles/identity portion of this library can be used to:

1.  transform a JSON profile into cryptographically-signed signed tokens
2.  recover a JSON profile from signed tokens
3.  validate signed profile tokens

_Note: this document uses ES6 in its examples but it is compiled down to Javascript (ES5) and is perfectly compatible with it. If you're using the latter, just make a few adjustments to the examples below (e.g. use "let" instead of "var")._

## Auth

[![Documentation](/docs-button.png)](/src/auth)

## Profiles

[![Documentation](/docs-button.png)](/src/profiles)

## Storage

[![Documentation](/docs-button.png)](/src/storage)

## Testing

    $ npm run test

### Testing in a browser

_This test will only work with your browser's Cross-Origin Restrictions disabled._

Run `npm run compile; npm run browserify` before opening the file `test.html`
in your browser.

## Documentation

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Authentication

Authentication methods.


### redirectToSignIn

Generates an authentication request and redirects the user to the Blockstack
browser to approve the sign in request.

Please note that this requires that the web browser properly handles the
`blockstack:` URL protocol handler.

Most applications should use this
method for sign in unless they require more fine grained control over how the
authentication request is generated. If your app falls into this category,
use `generateAndStoreAppKey`, `makeAuthRequest`,
and `redirectToSignInWithAuthRequest` to build your own sign in process.

**Parameters**

-   `redirectURI` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The location to which the identity provider will redirect the user after
    the user approves sign in. (optional, default `` `${window.location.origin}/` ``)
-   `manifestURI` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Location of the manifest file. (optional, default `` `${window.location.origin}/manifest.json` ``)
-   `scopes` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** Defaults to requesting write access to
    this app's data store.
    An array of strings indicating which permissions this app is requesting. (optional, default `DEFAULT_SCOPE`)

Returns **void** 

### isSignInPending

Check if there is a authentication request that hasn't been handled.

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** `true` if there is a pending sign in, otherwise `false`

### handlePendingSignIn

Try to process any pending sign in request by returning a `Promise` that resolves
to the user data object if the sign in succeeds.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** that resolves to the user data object if successful and rejects
if handling the sign in request fails or there was no pending sign in request.

### loadUserData

Retrieves the user data object. The user's profile is stored in the key `profile`.

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** User data object.

### isUserSignedIn

Check if a user is currently signed in.

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** `true` if the user is signed in, `false` if not.

### signUserOut

Sign the user out and redirect to given location.

**Parameters**

-   `redirectURL` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Location to redirect user to after sign out. (optional, default `'/'`)

Returns **void** 

### makeAuthRequest

Generates an authentication request that can be sent to the Blockstack
browser for the user to approve sign in.

**Parameters**

-   `transitPrivateKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** hex encoded app private key (optional, default `generateAndStoreAppKey()`)
-   `redirectURI` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** location to redirect user to after sign in approval (optional, default `` `${window.location.origin}/` ``)
-   `manifestURI` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** location of this app's manifest file (optional, default `` `${window.location.origin}/manifest.json` ``)
-   `scopes` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** the permissions this app is requesting (optional, default `DEFAULT_SCOPE`)
-   `appDomain` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the origin of this app (optional, default `window.location.origin`)
-   `expiresAt` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** the time at which this request is no longer valid (optional, default `nextHour().getTime()`)

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the authentication request

### redirectToSignInWithAuthRequest

Redirects the user to the Blockstack browser to approve the sign in request
given.

The user is redirected to the `blockstackIDHost` if the `blockstack:`
protocol handler is not detected. Please note that the protocol handler detection
does not work on all browsers.

**Parameters**

-   `authRequest` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the authentication request generated by `makeAuthRequest` (optional, default `makeAuthRequest()`)
-   `blockstackIDHost` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the URL to redirect the user to if the blockstack
                                        protocol handler is not detected (optional, default `DEFAULT_BLOCKSTACK_HOST`)

Returns **void** 

### getAuthResponseToken

Retrieve the authentication token from the URL query

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the authentication token if it exists otherwise `null`

### Profiles

Profile methods.


### extractProfile

Extracts a profile from an encoded token and optionally verifies it,
if `publicKeyOrAddress` is provided.

**Parameters**

-   `token` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the token to be extracted
-   `publicKeyOrAddress` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the public key or address of the
      keypair that is thought to have signed the token (optional, default `null`)


-   Throws **[Error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error)** if the token isn't signed by the provided `publicKeyOrAddress`

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the profile extracted from the encoded token

### wrapProfileToken

Wraps a token for a profile token file

**Parameters**

-   `token` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the token to be wrapped

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** including `token` and `decodedToken`

### signProfileToken

Signs a profile token

**Parameters**

-   `profile` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the JSON of the profile to be signed
-   `privateKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the signing private key
-   `subject` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the entity that the information is about (optional, default `null`)
-   `issuer` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the entity that is issuing the token (optional, default `null`)
-   `signingAlgorithm` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the signing algorithm to use (optional, default `'ES256K'`)
-   `issuedAt` **[Date](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)** the time of issuance of the token (optional, default `new Date()`)
-   `expiresAt` **[Date](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)** the time of expiration of the token (optional, default `nextYear()`)

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the signed profile token

### verifyProfileToken

Verifies a profile token

**Parameters**

-   `token` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the token to be verified
-   `publicKeyOrAddress` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the public key or address of the
      keypair that is thought to have signed the token


-   Throws **[Error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error)** throws an error if token verification fails

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** the verified, decoded profile token

### storage

Storage methods.


### getFile

Retrives the specified file from the app's data store.

**Parameters**

-   `path` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the path to the file to read

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** that resolves to the raw data in the file
or rejects with an error

### putFile

Stores the data provided in the file specified.

**Parameters**

-   `path` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** the path to store the data in
-   `contents` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Buffer](https://nodejs.org/api/buffer.html))** the data to store in the file

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** that resolves if the operation succeed and rejects
if it failed
